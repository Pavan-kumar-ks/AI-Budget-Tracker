<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Budget Tracker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        :root {
            --primary-color: #5664d2;
            --primary-dark: #4254c7;
            --warning-color: #f9a825;
            --danger-color: #e53935;
            --success-color: #43a047;
            --gradient-start: #5664d2;
            --gradient-end: #7c8bff;
        }
        
        * {
            box-sizing: border-box;
            transition: all 0.3s ease;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f7fb;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(120, 140, 255, 0.05) 0%, rgba(86, 100, 210, 0.1) 90%),
                linear-gradient(to right, rgba(245, 247, 251, 0.9) 0%, rgba(245, 247, 251, 0.9) 100%);
            background-attachment: fixed;
            min-height: 100vh;
        }
        
        #app-container {
            display: none;
            animation-duration: 0.8s;
        }
        
        #login-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 80vh;
            animation-duration: 0.8s;
        }
        
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
        
        h1, h2, h3 {
            color: #2c3e50;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
            padding-bottom: 15px;
        }
        
        h1:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 3px;
            background: linear-gradient(to right, var(--gradient-start), var(--gradient-end));
        }
        
        .login-card {
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(86, 100, 210, 0.2);
            width: 400px;
            max-width: 100%;
            text-align: center;
        }
        
        .login-logo {
            font-size: 48px;
            margin-bottom: 20px;
            color: var(--primary-color);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            transform: translateY(0);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            background-color: #f8f9fc;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(86, 100, 210, 0.1);
        }
        
        button {
            background: linear-gradient(to right, var(--gradient-start), var(--gradient-end));
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(86, 100, 210, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        button:hover {
            box-shadow: 0 6px 15px rgba(86, 100, 210, 0.3);
            transform: translateY(-2px);
        }
        
        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(86, 100, 210, 0.2);
        }
        
        button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }
        
        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(100, 100);
                opacity: 0;
            }
        }
        
        button:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }
        
        .budget-score {
            font-size: 36px;
            font-weight: bold;
            text-align: center;
            width: 120px;
            height: 120px;
            line-height: 120px;
            margin: 0 auto 20px;
            color: white;
            border-radius: 50%;
            position: relative;
            background: conic-gradient(var(--success-color) 0%, var(--success-color) 85%, #e0e0e0 85%, #e0e0e0 100%);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.5s ease;
        }
        
        .budget-score::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            border-radius: 50%;
            background: white;
        }
        
        .budget-score span {
            position: relative;
            z-index: 2;
        }
        
        .good {
            background: conic-gradient(var(--success-color) 0%, var(--success-color) var(--percentage), #e0e0e0 var(--percentage), #e0e0e0 100%);
            color: var(--success-color);
        }
        
        .warning {
            background: conic-gradient(var(--warning-color) 0%, var(--warning-color) var(--percentage), #e0e0e0 var(--percentage), #e0e0e0 100%);
            color: var(--warning-color);
        }
        
        .danger {
            background: conic-gradient(var(--danger-color) 0%, var(--danger-color) var(--percentage), #e0e0e0 var(--percentage), #e0e0e0 100%);
            color: var(--danger-color);
        }
        
        .expense-list {
            max-height: 300px;
            overflow-y: auto;
            padding-right: 5px;
        }
        
        .expense-list::-webkit-scrollbar {
            width: 5px;
        }
        
        .expense-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .expense-list::-webkit-scrollbar-thumb {
            background: #c5c9e0;
            border-radius: 10px;
        }
        
        .expense-item {
            padding: 15px;
            margin-bottom: 8px;
            border-radius: 6px;
            background-color: #f8f9fc;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            animation-duration: 0.5s;
        }
        
        .expense-amount {
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        
        .insights {
            background-color: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 4px solid #4b97ff;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }
        
        .alert {
            padding: 12px 15px;
            border-radius: 6px;
            margin-bottom: 12px;
            font-weight: 600;
            animation-duration: 0.7s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .alert-warning {
            background-color: #fff3e0;
            color: #e65100;
            border-left: 3px solid #e65100;
        }
        
        .alert-danger {
            background-color: #ffebee;
            color: #c62828;
            border-left: 3px solid #c62828;
        }
        
        .alert-info {
            background-color: #e1f5fe;
            color: #0277bd;
            border-left: 3px solid #0277bd;
        }
        
        .tip {
            margin-top: 10px;
            font-style: italic;
            padding: 10px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 6px;
        }
        
        .category-badge {
            display: inline-block;
            padding: 4px 8px;
            font-size: 12px;
            font-weight: bold;
            border-radius: 15px;
            color: white;
            margin-right: 5px;
        }
        
        .category-food {
            background-color: #4CAF50;
        }
        
        .category-housing {
            background-color: #2196F3;
        }
        
        .category-transportation {
            background-color: #FF9800;
        }
        
        .category-entertainment {
            background-color: #9C27B0;
        }
        
        .category-shopping {
            background-color: #F44336;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .logout-btn {
            background: none;
            color: #666;
            box-shadow: none;
            padding: 8px 15px;
        }
        
        .logout-btn:hover {
            color: var(--primary-color);
            background: rgba(86, 100, 210, 0.1);
            box-shadow: none;
        }
        
        /* Animation classes */
        .fade-in {
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .slide-up {
            animation: slideUp 0.5s;
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .slide-in {
            animation: slideIn 0.5s;
        }
        
        @keyframes slideIn {
            from { transform: translateX(20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Loading animation */
        .loader {
            display: inline-block;
            position: relative;
            width: 80px;
            height: 80px;
            margin: 0 auto;
        }
        
        .loader div {
            position: absolute;
            top: 33px;
            width: 13px;
            height: 13px;
            border-radius: 50%;
            background: var(--primary-color);
            animation-timing-function: cubic-bezier(0, 1, 1, 0);
        }
        
        .loader div:nth-child(1) {
            left: 8px;
            animation: loader1 0.6s infinite;
        }
        
        .loader div:nth-child(2) {
            left: 8px;
            animation: loader2 0.6s infinite;
        }
        
        .loader div:nth-child(3) {
            left: 32px;
            animation: loader2 0.6s infinite;
        }
        
        .loader div:nth-child(4) {
            left: 56px;
            animation: loader3 0.6s infinite;
        }
        
        @keyframes loader1 {
            0% { transform: scale(0); }
            100% { transform: scale(1); }
        }
        
        @keyframes loader3 {
            0% { transform: scale(1); }
            100% { transform: scale(0); }
        }
        
        @keyframes loader2 {
            0% { transform: translate(0, 0); }
            100% { transform: translate(24px, 0); }
        }
        
        /* Toast notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }
        
        .toast {
            background-color: white;
            color: #333;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-width: 300px;
            max-width: 450px;
            transform: translateX(120%);
            animation: slideInRight 0.3s forwards, fadeOut 0.5s 2.5s forwards;
        }
        
        .toast.success {
            border-left: 5px solid var(--success-color);
        }
        
        .toast.error {
            border-left: 5px solid var(--danger-color);
        }
        
        .toast.info {
            border-left: 5px solid var(--primary-color);
        }
        
        .toast-content {
            flex-grow: 1;
        }
        
        .toast-close {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            padding: 0;
            margin-left: 10px;
            box-shadow: none;
        }
        
        .toast-close:hover {
            color: #333;
            transform: none;
            box-shadow: none;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(120%); }
            to { transform: translateX(0); }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; visibility: hidden; }
        }
    </style>
</head>
<body>
    <!-- Toast Notifications Container -->
    <div id="toast-container" class="toast-container"></div>
    
    <!-- Login Container -->
    <div id="login-container" class="animate__animated animate__fadeIn">
        <div class="login-card">
            <div class="login-logo">💰</div>
            <h1>Budget Tracker</h1>
            <p>Log in to manage your finances smartly</p>
            
            <form id="login-form">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" placeholder="Enter your username" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Enter your password" required>
                </div>
                <button type="submit" id="login-button">Log In</button>
            </form>
            
            <p style="margin-top: 20px; font-size: 14px; color: #666;">
                Don't have an account? <a href="#" style="color: var(--primary-color);">Sign up</a>
            </p>
        </div>
    </div>
    
    <!-- App Container (Hidden by Default) -->
    <div id="app-container" class="animate__animated animate__fadeIn">
        <div class="header">
            <h1>AI Budget Tracker</h1>
            <div class="user-profile">
                <div class="avatar" id="user-avatar">JS</div>
                <div>
                    <div id="user-name">John Smith</div>
                    <button class="logout-btn" id="logout-button">Logout</button>
                </div>
            </div>
        </div>
        
        <div class="container">
            <div>
                <!-- Input Form -->
                <div class="card slide-up">
                    <h2>Add New Expense</h2>
                    <div class="form-group">
                        <label for="expense-description">Description</label>
                        <input type="text" id="expense-description" placeholder="What did you spend on?">
                    </div>
                    <div class="form-group">
                        <label for="expense-amount">Amount ($)</label>
                        <input type="number" id="expense-amount" min="0" step="0.01" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label for="expense-category">Category</label>
                        <select id="expense-category">
                            <option value="food">Food & Dining</option>
                            <option value="housing">Housing & Utilities</option>
                            <option value="transportation">Transportation</option>
                            <option value="entertainment">Entertainment</option>
                            <option value="shopping">Shopping</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="expense-date">Date</label>
                        <input type="date" id="expense-date">
                    </div>
                    <button id="add-expense">Add Expense</button>
                </div>
                
                <!-- Budget Setup -->
                <div class="card slide-up" style="animation-delay: 0.1s;">
                    <h2>Budget Settings</h2>
                    <div class="form-group">
                        <label for="budget-food">Food & Dining Budget ($)</label>
                        <input type="number" id="budget-food" value="500">
                    </div>
                    <div class="form-group">
                        <label for="budget-housing">Housing & Utilities Budget ($)</label>
                        <input type="number" id="budget-housing" value="1200">
                    </div>
                    <div class="form-group">
                        <label for="budget-transportation">Transportation Budget ($)</label>
                        <input type="number" id="budget-transportation" value="300">
                    </div>
                    <div class="form-group">
                        <label for="budget-entertainment">Entertainment Budget ($)</label>
                        <input type="number" id="budget-entertainment" value="200">
                    </div>
                    <div class="form-group">
                        <label for="budget-shopping">Shopping Budget ($)</label>
                        <input type="number" id="budget-shopping" value="300">
                    </div>
                    <button id="save-budget">Save Budget</button>
                </div>
            </div>
            
            <div>
                <!-- Budget Score -->
                <div class="card slide-up" style="animation-delay: 0.2s;">
                    <h2>Budget Health</h2>
                    <div class="budget-score good" id="budget-score"><span>85</span></div>
                    <div id="score-explanation" style="text-align: center; margin-bottom: 20px;">Your budget is in good health! Keep it up.</div>
                    
                    <div class="insights" id="ai-insights">
                        <h3>AI Insights</h3>
                        <div id="insights-content">
                            <div class="alert alert-info animate__animated animate__fadeIn">Welcome! Add your expenses to get personalized insights.</div>
                        </div>
                    </div>
                </div>
                
                <!-- Expense Chart -->
                <div class="card slide-up" style="animation-delay: 0.3s;">
                    <h2>Spending Overview</h2>
                    <div class="chart-container">
                        <canvas id="expense-chart"></canvas>
                    </div>
                </div>
                
                <!-- Recent Expenses -->
                <div class="card slide-up" style="animation-delay: 0.4s;">
                    <h2>Recent Expenses</h2>
                    <div class="expense-list" id="expense-list">
                        <!-- Expenses will be added here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize data structures
        let expenses = JSON.parse(localStorage.getItem('expenses')) || [];
        let budgets = JSON.parse(localStorage.getItem('budgets')) || {
            food: 500,
            housing: 1200,
            transportation: 300,
            entertainment: 200,
            shopping: 300
        };
        
        // User management
        let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
        const users = JSON.parse(localStorage.getItem('users')) || [
            { username: 'demo', password: 'password', displayName: 'Demo User', initials: 'DU' }
        ];
        
        // Check if user is already logged in
        if (currentUser) {
            showApp();
            updateUserInfo();
        }
        
        // Login form event listener
        document.getElementById('login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Show loading animation
            const loginButton = document.getElementById('login-button');
            const originalButtonText = loginButton.textContent;
            loginButton.innerHTML = '<div class="loader"><div></div><div></div><div></div><div></div></div>';
            loginButton.disabled = true;
            
            // Simulate a network request
            setTimeout(() => {
                const user = users.find(u => u.username === username && u.password === password);
                
                if (user) {
                    // Successful login
                    currentUser = {
                        username: user.username,
                        displayName: user.displayName,
                        initials: user.initials
                    };
                    
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    // Hide login form with animation
                    document.getElementById('login-container').classList.remove('animate__fadeIn');
                    document.getElementById('login-container').classList.add('animate__fadeOut');
                    
                    setTimeout(() => {
                        showApp();
                        updateUserInfo();
                        showToast('Successfully logged in!', 'success');
                    }, 500);
                } else {
                    // Failed login
                    showToast('Invalid username or password', 'error');
                    loginButton.textContent = originalButtonText;
                    loginButton.disabled = false;
                }
            }, 1000);
        });
        
        // Logout button event listener
        document.getElementById('logout-button').addEventListener('click', function() {
            // Hide app with animation
            document.getElementById('app-container').classList.remove('animate__fadeIn');
            document.getElementById('app-container').classList.add('animate__fadeOut');
            
            setTimeout(() => {
                // Clear current user
                localStorage.removeItem('currentUser');
                currentUser = null;
                
                // Show login form
                document.getElementById('login-container').style.display = 'flex';
                document.getElementById('login-container').classList.remove('animate__fadeOut');
                document.getElementById('login-container').classList.add('animate__fadeIn');
                document.getElementById('app-container').style.display = 'none';
                
                // Clear form fields
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                
                showToast('You have been logged out', 'info');
            }, 500);
        });
        
        // Function to show the app
        function showApp() {
            document.getElementById('login-container').style.display = 'none';
            document.getElementById('app-container').style.display = 'block';
            document.getElementById('app-container').classList.remove('animate__fadeOut');
            document.getElementById('app-container').classList.add('animate__fadeIn');
            
            // Initialize the app data
            loadInitialData();
        }
        
        // Update user info in the header
        function updateUserInfo() {
            if (currentUser) {
                document.getElementById('user-name').textContent = currentUser.displayName;
                document.getElementById('user-avatar').textContent = currentUser.initials;
            }
        }
        
        // Load saved budgets into form
        function loadInitialData() {
            document.getElementById('budget-food').value = budgets.food;
            document.getElementById('budget-housing').value = budgets.housing;
            document.getElementById('budget-transportation').value = budgets.transportation;
            document.getElementById('budget-entertainment').value = budgets.entertainment;
            document.getElementById('budget-shopping').value = budgets.shopping;
            
            // Set today's date as default
            document.getElementById('expense-date').valueAsDate = new Date();
            
            // Load initial data
            updateExpenseList();
            updateCharts();
            updateBudgetScore();
            generateAIInsights();
        }
        
        // Show toast notification
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            toast.innerHTML = `
                <div class="toast-content">
                    <strong>${type === 'success' ? '✓ Success' : type === 'error' ? '✗ Error' : 'ℹ Info'}</strong>
                    <div>${message}</div>
                </div>
                <button class="toast-close">×</button>
            `;
            
            toastContainer.appendChild(toast);
            
            // Add close event
            toast.querySelector('.toast-close').addEventListener('click', function() {
                toast.remove();
            });
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
        
        // Event Listeners
        document.getElementById('add-expense').addEventListener('click', addExpense);
        document.getElementById('save-budget').addEventListener('click', saveBudget);
        
        // Add expense function
        function addExpense() {
            const description = document.getElementById('expense-description').value;
            const amount = parseFloat(document.getElementById('expense-amount').value);
            const category = document.getElementById('expense-category').value;
            const date = document.getElementById('expense-date').value;
            
            if (!description || isNaN(amount) || amount <= 0 || !date) {
                showToast('Please fill in all fields correctly', 'error');
                return;
            }
            
            // NLP for expense categorization - simple keyword matching
            let detectedCategory = category;
            const keywords = {
                food: ['grocery', 'restaurant', 'cafe', 'dinner', 'lunch', 'breakfast', 'food', 'meal', 'coffee'],
                housing: ['rent', 'mortgage', 'utilities', 'electric', 'water', 'gas', 'internet', 'repair'],
                transportation: ['gas', 'fuel', 'car', 'bus', 'train', 'uber', 'lyft', 'taxi', 'transit'],
                entertainment: ['movie', 'netflix', 'spotify', 'game', 'concert', 'theater', 'show'],
                shopping: ['clothes', 'amazon', 'mall', 'shop', 'store', 'purchase']
            };
            
            const descLower = description.toLowerCase();
            for (const [cat, words] of Object.entries(keywords)) {
                if (words.some(word => descLower.includes(word))) {
                    detectedCategory = cat;
                    break;
                }
            }
            
            const newExpense = {
                id: Date.now(),
                description,
                amount,
                category: detectedCategory,
                date,
                timestamp: new Date().toISOString()
            };
            
            expenses.push(newExpense);
            localStorage.setItem('expenses', JSON.stringify(expenses));
            
            // Clear form
            document.getElementById('expense-description').value = '';
            document.getElementById('expense-amount').value = '';
            document.getElementById('expense-date').valueAsDate = new Date();
            
            // Update UI
            updateExpenseList();
            updateCharts();
            updateBudgetScore();
            generateAIInsights();
            
            // Show different toast based on budget condition
            const categoryBudget = budgets[detectedCategory];
            const categoryTotal = getCategoryTotal(detectedCategory);
            
            if (categoryTotal > categoryBudget) {
                showToast(`Warning: You've exceeded your ${getCategoryName(detectedCategory)} budget!`, 'error');
            } else if (categoryTotal > (categoryBudget * 0.8)) {
                showToast(`You're approaching your ${getCategoryName(detectedCategory)} budget limit`, 'info');
            } else {
                showToast('Expense added successfully!', 'success');
            }
        }
        
        // Save budget settings
        function saveBudget() {
            budgets = {
                food: parseFloat(document.getElementById('budget-food').value) || 0,
                housing: parseFloat(document.getElementById('budget-housing').value) || 0,
                transportation: parseFloat(document.getElementById('budget-transportation').value) || 0,
                entertainment: parseFloat(document.getElementById('budget-entertainment').value) || 0,
                shopping: parseFloat(document.getElementById('budget-shopping').value) || 0
            };
            
            localStorage.setItem('budgets', JSON.stringify(budgets));
            showToast('Budget updated successfully!', 'success');
            
            // Update UI
            updateBudgetScore();
            updateCharts();
            generateAIInsights();
        }
        
        // Update expense list
        function updateExpenseList() {
            const expenseList = document.getElementById('expense-list');
            expenseList.innerHTML = '';
            
            // Sort expenses by date (newest first)
            const sortedExpenses = [...expenses].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Take only the 10 most recent expenses
            const recentExpenses = sortedExpenses.slice(0, 10);
            
            if (recentExpenses.length === 0) {
                const emptyMessage = document.createElement('div');
                emptyMessage.textContent = 'No expenses yet. Add your first expense!';
                emptyMessage.style.textAlign = 'center';
                emptyMessage.style.padding = '20px';
                emptyMessage.style.color = '#666';
                expenseList.appendChild(emptyMessage);
                return;
            }
            
            // Add expenses to the list
            recentExpenses.forEach((expense, index) => {
                const expenseItem = document.createElement('div');
                expenseItem.className = 'expense-item animate__animated animate__fadeIn';
                expenseItem.style.animationDelay = `${index * 0.05}s`;
                
                // Format date
                const expenseDate = new Date(expense.date);
                const formattedDate = expenseDate.toLocaleDateString();
                
                expenseItem.innerHTML = `
                    <div>
                        <div>${expense.description}</div>
                        <div style="font-size: 12px; color: #666;">${formattedDate}</div>
                        <span class="category-badge category-${expense.category}">${getCategoryName(expense.category)}</span>
                    </div>
                    <div class="expense-amount">$${expense.amount.toFixed(2)}</div>
                `;
                
                // Add delete button
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = '×';
                deleteBtn.style.background = 'none';
                deleteBtn.style.border = 'none';
                deleteBtn.style.color = '#666';
                deleteBtn.style.cursor = 'pointer';
                deleteBtn.style.fontSize = '20px';
                deleteBtn.style.padding = '0 5px';
                deleteBtn.style.boxShadow = 'none';
                
                deleteBtn.addEventListener('click', () => {
                    // Remove expense from array
                    expenses = expenses.filter(e => e.id !== expense.id);
                    localStorage.setItem('expenses', JSON.stringify(expenses));
                    
                    // Remove item with animation
                    expenseItem.classList.add('animate__fadeOut');
                    setTimeout(() => {
                        updateExpenseList();
                        updateCharts();
                        updateBudgetScore();
                        generateAIInsights();
                        showToast('Expense deleted', 'info');
                    }, 300);
                });
                
                expenseItem.appendChild(deleteBtn);
                expenseList.appendChild(expenseItem);
            });
        }
        
        // Update charts
        function updateCharts() {
            // Get canvas context
            const ctx = document.getElementById('expense-chart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (window.expenseChart) {
                window.expenseChart.destroy();
            }
            
            // Calculate category totals
            const categoryTotals = {
                food: getCategoryTotal('food'),
                housing: getCategoryTotal('housing'),
                transportation: getCategoryTotal('transportation'),
                entertainment: getCategoryTotal('entertainment'),
                shopping: getCategoryTotal('shopping')
            };
            
            // Calculate percentages of budget used
            const percentages = {
                food: (categoryTotals.food / budgets.food) * 100,
                housing: (categoryTotals.housing / budgets.housing) * 100,
                transportation: (categoryTotals.transportation / budgets.transportation) * 100,
                entertainment: (categoryTotals.entertainment / budgets.entertainment) * 100,
                shopping: (categoryTotals.shopping / budgets.shopping) * 100
            };
            
            // Create chart data
            const chartData = {
                labels: [
                    'Food & Dining',
                    'Housing & Utilities',
                    'Transportation',
                    'Entertainment',
                    'Shopping'
                ],
                datasets: [
                    {
                        label: 'Current Spending ($)',
                        data: [
                            categoryTotals.food,
                            categoryTotals.housing,
                            categoryTotals.transportation,
                            categoryTotals.entertainment,
                            categoryTotals.shopping
                        ],
                        backgroundColor: 'rgba(86, 100, 210, 0.7)',
                        borderColor: 'rgba(86, 100, 210, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Budget ($)',
                        data: [
                            budgets.food,
                            budgets.housing,
                            budgets.transportation,
                            budgets.entertainment,
                            budgets.shopping
                        ],
                        backgroundColor: 'rgba(150, 150, 150, 0.3)',
                        borderColor: 'rgba(150, 150, 150, 0.7)',
                        borderWidth: 1,
                        borderDash: [5, 5]
                    }
                ]
            };
            
            // Create chart options
            const chartOptions = {
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed.y !== null) {
                                    label += new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(context.parsed.y);
                                }
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return '$' + value;
                            }
                        }
                    }
                },
                responsive: true,
                maintainAspectRatio: false,
                animation: {
                    duration: 1000
                }
            };
            
            // Create new chart
            window.expenseChart = new Chart(ctx, {
                type: 'bar',
                data: chartData,
                options: chartOptions
            });
        }
        
        // Update budget score
        function updateBudgetScore() {
            const budgetScore = document.getElementById('budget-score');
            const scoreExplanation = document.getElementById('score-explanation');
            
            // Calculate overall budget health
            const totalBudget = Object.values(budgets).reduce((sum, budget) => sum + budget, 0);
            const totalSpent = expenses.reduce((sum, expense) => sum + expense.amount, 0);
            const budgetPercentage = (totalSpent / totalBudget) * 100;
            
            // Calculate score based on budget percentage
            let score = 100;
            
            // Deduct points for exceeding category budgets
            for (const category in budgets) {
                const categoryTotal = getCategoryTotal(category);
                const categoryBudget = budgets[category];
                
                if (categoryTotal > categoryBudget) {
                    // Deduct points based on how much the budget is exceeded
                    const excessPercentage = (categoryTotal - categoryBudget) / categoryBudget;
                    score -= excessPercentage * 20; // Deduct up to 20 points per category
                }
            }
            
            // Deduct points for overall spending relative to budget
            if (budgetPercentage > 100) {
                score -= (budgetPercentage - 100) * 0.5; // Deduct 0.5 points for each 1% over budget
            } else if (budgetPercentage > 90) {
                score -= (budgetPercentage - 90) * 0.3; // Deduct 0.3 points for each 1% approaching budget
            }
            
            // Ensure score stays within 0-100 range
            score = Math.max(0, Math.min(100, Math.round(score)));
            
            // Update score display
            budgetScore.innerHTML = `<span>${score}</span>`;
            
            // Update class based on score
            budgetScore.className = 'budget-score';
            if (score >= 80) {
                budgetScore.classList.add('good');
                scoreExplanation.textContent = 'Your budget is in good health! Keep it up.';
            } else if (score >= 60) {
                budgetScore.classList.add('warning');
                scoreExplanation.textContent = 'Your budget is okay, but there\'s room for improvement.';
            } else {
                budgetScore.classList.add('danger');
                scoreExplanation.textContent = 'Your budget needs attention. Check your spending habits.';
            }
            
            // Set the custom property for the circle percentage
            budgetScore.style.setProperty('--percentage', `${score}%`);
        }
        
        // Generate AI insights
        function generateAIInsights() {
            const insightsContent = document.getElementById('insights-content');
            insightsContent.innerHTML = '';
            
            // Check if we have enough data
            if (expenses.length === 0) {
                const emptyMessage = document.createElement('div');
                emptyMessage.className = 'alert alert-info';
                emptyMessage.textContent = 'Add your expenses to get personalized insights.';
                insightsContent.appendChild(emptyMessage);
                return;
            }
            
            // Check for overbudget categories
            const overBudgetCategories = [];
            for (const category in budgets) {
                const categoryTotal = getCategoryTotal(category);
                const categoryBudget = budgets[category];
                
                if (categoryTotal > categoryBudget) {
                    overBudgetCategories.push({
                        name: getCategoryName(category),
                        amount: categoryTotal - categoryBudget,
                        percentage: (categoryTotal / categoryBudget) * 100 - 100
                    });
                }
            }
            
            // Sort by percentage over budget
            overBudgetCategories.sort((a, b) => b.percentage - a.percentage);
            
            // Add warnings for over-budget categories
            if (overBudgetCategories.length > 0) {
                overBudgetCategories.forEach(category => {
                    const alert = document.createElement('div');
                    alert.className = 'alert alert-warning animate__animated animate__fadeIn';
                    alert.innerHTML = `
                        <strong>Budget Alert:</strong> You've exceeded your ${category.name} budget by 
                        <strong>$${category.amount.toFixed(2)}</strong> (${category.percentage.toFixed(1)}% over).
                    `;
                    insightsContent.appendChild(alert);
                });
                
                // Add a tip for the most over-budget category
                const worstCategory = overBudgetCategories[0];
                
                // Generate a contextual tip
                let tip = '';
                switch (worstCategory.name.toLowerCase()) {
                    case 'food & dining':
                        tip = 'Try meal prepping at home or using grocery shopping apps to find deals.';
                        break;
                    case 'housing & utilities':
                        tip = 'Consider checking for energy leaks or unplugging electronics when not in use.';
                        break;
                    case 'transportation':
                        tip = 'Consider carpooling, public transit, or combining errands into single trips.';
                        break;
                    case 'entertainment':
                        tip = 'Look for free events in your area or take advantage of subscription trials.';
                        break;
                    case 'shopping':
                        tip = 'Wait 24 hours before making non-essential purchases to avoid impulse buys.';
                        break;
                }
                
                const tipDiv = document.createElement('div');
                tipDiv.className = 'tip animate__animated animate__fadeIn';
                tipDiv.style.animationDelay = '0.3s';
                tipDiv.innerHTML = `<strong>Tip:</strong> ${tip}`;
                insightsContent.appendChild(tipDiv);
            } else {
                // Everything is under budget
                const alert = document.createElement('div');
                alert.className = 'alert alert-info animate__animated animate__fadeIn';
                alert.innerHTML = '<strong>Great job!</strong> All your spending is within budget.';
                insightsContent.appendChild(alert);
            }
            
            // Find spending trends
            const now = new Date();
            const lastWeekExpenses = expenses.filter(e => {
                const expenseDate = new Date(e.date);
                const daysDiff = (now - expenseDate) / (1000 * 60 * 60 * 24);
                return daysDiff <= 7;
            });
            
            // Check if spending has increased
            if (lastWeekExpenses.length >= 3) {
                const lastWeekTotal = lastWeekExpenses.reduce((sum, expense) => sum + expense.amount, 0);
                const averageDailySpend = lastWeekTotal / 7;
                
                if (averageDailySpend > 50) { // Arbitrary threshold
                    const alert = document.createElement('div');
                    alert.className = 'alert alert-info animate__animated animate__fadeIn';
                    alert.style.animationDelay = '0.6s';
                    alert.innerHTML = `
                        <strong>Spending Trend:</strong> Your average daily spend is <strong>$${averageDailySpend.toFixed(2)}</strong> 
                        over the past week. This might be higher than normal.
                    `;
                    insightsContent.appendChild(alert);
                }
            }
        }
        
        // Helper functions
        function getCategoryTotal(category) {
            return expenses
                .filter(expense => expense.category === category)
                .reduce((total, expense) => total + expense.amount, 0);
        }
        
        function getCategoryName(category) {
            const names = {
                food: 'Food & Dining',
                housing: 'Housing & Utilities',
                transportation: 'Transportation',
                entertainment: 'Entertainment',
                shopping: 'Shopping'
            };
            return names[category] || category;
        }
        
        // Set today's date as default for expense-date input
        document.addEventListener('DOMContentLoaded', function() {
            if (document.getElementById('expense-date')) {
                document.getElementById('expense-date').valueAsDate = new Date();
            }
        });
    </script>
</body>
</html>
